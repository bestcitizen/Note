---
layout: base
---

<script>

  var pages = getPages();
  console.log("pages");
  console.log(pages);

  var nodes = makeNodes(pages);
  console.log("nodes");
  console.log(nodes);

  var root = groupNodes(nodes);
  console.log("root");
  console.log(root);

  var list = document.createElement("ul");
  makeList(root, list);

  list.removeChild(list.querySelector("li"));
  document.querySelector("main").innerHTML = list.innerHTML;




  function makeList(node, list) {
    if (node.children != undefined) {
      var index = node.children.filter(child => child.isIndex)[0];
      node.children = node.children.filter(child => !child.isIndex);

      var listItem = document.createElement("li");
      if (index != undefined) {
        var anchor = document.createElement("a");
        anchor.innerHTML = index.name;
        anchor.href = index.url;
        listItem.appendChild(anchor);
      } else {
        listItem.innerHTML = node.name + " ---- You must add 'index.md' file for this category.";
      }
      list.appendChild(listItem);

      var childList = document.createElement("ul");
      for (var i = 0; i < node.children.length; i++) {
        makeList(node.children[i], childList);
      }

      list.appendChild(childList);

    } else {
      var listItem = document.createElement("li");
      var anchor = document.createElement("a");

      listItem.appendChild(anchor);

      anchor.innerHTML = node.name;
      anchor.href = node.url;

      list.appendChild(listItem);
    }
  }

  function capitalizeKebab(str) {
    return ;
  }




  function groupNodes(nodes) {
    var root = {name: "root"};
    root.children = nodes;

    return groupNode(root);
  }

  function groupNode(node) {
    var categories = Array.from(new Set(node.children.filter(child => child.children != undefined).map(child => child.name)));

    for (var i = 0; i < categories.length; i++) {
      var category = categories[i];
      var groupedNode = {
        name: category,
        children: node.children.filter(child => child.name === category).map(child => child.children).flat(Infinity)
      };

      node.children = node.children.filter(child => child.name != category);
      node.children.push(groupedNode);

      if (groupedNode.children != undefined) {
        groupNode(groupedNode);
      }
    }

    return node;
  }




  function makeNodes(pages) {
    var nodes = pages.map(page => makeNode(page));
    return nodes;
  }

  function makeNode(page) {
    var leaf = {
      name: page.title,
      url: page.url,
      isIndex: page.name === "index"
    }
    return makeMultiDepthNode(page.category, leaf, 1);
  }

  function makeMultiDepthNode(category, child, indent) {
    var node = {
      name: category[category.length - indent],
      children: [child]
    };

    while (indent < category.length) {
      indent++;
      return makeMultiDepthNode(category, node, indent);
    }

    return node;
  }




  function getPages() {
    var pages = [];

    {% for note in site.notes %}
      var id = "{{ note.id }}".split("/");

      pages.push({
        category: id.slice(2, id.length - 1),
        name: id[id.length - 1],
        title: "{{ note.title }}",
        url: "{{ note.url | relative_url }}",
      });
    {% endfor %}

    return pages;
  }

</script>
