<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, maximum-scale=1" />
    {% feed_meta %}
    {% seo %}
    <link rel="stylesheet" href="{{ '/assets/css/skill-base.css' | relative_url }}">
    <script src="https://unpkg.com/simple-jekyll-search@latest/dest/simple-jekyll-search.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script src="{{ '/assets/js/typing-effect.js' | relative_url }}"></script>
</head>

<body>
    <nav>
        <a id="logo" href="{{ '/skills' | relative_url }}"><img /></a>
        <input id="searchInput" type="text" placeholder="제목, 내용, 날짜" oninput="window.scrollTo(0,0);">
        <div>
            <a id="theme" onclick="toggleTheme()"><img></a>
            <a id="search" onclick="toggleSearch()"><img></a>
        </div>
    </nav>
    <div id="searchResult"></div>
    <main>
        {{ content }}
    </main>
    <footer>
        <hr>
        <p>(C) {{ "now" | date: "%Y" }}. {{ site.author.name }} all rights reserved.</p>
    </footer>
</body>

<script>
    let hljsStyle = document.createElement('link');
    hljsStyle.rel = 'stylesheet';
    document.head.appendChild(hljsStyle);

    setTheme();


    SimpleJekyllSearch({
        searchInput: document.getElementById('searchInput'),
        resultsContainer: document.getElementById('searchResult'),
        json: '/assets/json/skill-search.json',
        searchResultTemplate: `<li><a href="{{ site.url }}{url}">{title}</a></li>`
    });

    function toggleSearch() {
        var searchInput = document.getElementById('searchInput');
        var searchResult = document.getElementById('searchResult');
        if (getComputedStyle(searchInput).display === 'none' || getComputedStyle(searchResult).display === 'none') {
            searchInput.style.display = 'block';
            searchResult.style.display = 'block';
            searchInput.focus();
        } else {
            searchInput.style.display = 'none';
            searchResult.style.display = 'none';
        }
    }

    function setTheme() {
        if (localStorage.getItem('theme') === 'light') {
            setLightTheme();
        } else if (localStorage.getItem('theme') === 'dark') {
            setDarkTheme();
        } else {
            localStorage.setItem('theme', 'light');
            setLightTheme();
        }
    }

    function toggleTheme() {
        const theme = localStorage.getItem('theme');
        if (theme === 'light') localStorage.setItem('theme', 'dark');
        else localStorage.setItem('theme', 'light');

        setTheme();
        if (document.querySelector('.language-mermaid') !== null) location.reload(true);
    }

    function setLightTheme() {
        document.body.style.setProperty('--background-color', '#eeeeee');
        document.body.style.setProperty('--background-highlight-color', '#dddddd');
        document.body.style.setProperty('--color', '#111111');
        document.body.style.setProperty('--code-color', '#880000');
        document.body.style.setProperty('--highlight-color', '#000000');
        document.body.style.setProperty('--border-color', '#aaaaaa');

        document.getElementById('logo').getElementsByTagName('img')[0].src = "{{ '/assets/img/skill-stamp/black.png' | relative_url }}";
        document.getElementById('theme').getElementsByTagName('img')[0].src = "{{ '/assets/icon/moon/black.svg' | relative_url }}";
        document.getElementById('search').getElementsByTagName('img')[0].src = "{{ '/assets/icon/magnifier/black.svg' | relative_url }}";

        hljsStyle.href = 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/vs.min.css';
        hljs.highlightAll();

        renderMermaid('neutral');
    }

    function setDarkTheme() {
        document.body.style.setProperty('--background-color', '#111111');
        document.body.style.setProperty('--background-highlight-color', '#222222');
        document.body.style.setProperty('--color', '#cccccc');
        document.body.style.setProperty('--code-color', '#bbddff');
        document.body.style.setProperty('--highlight-color', '#ffffff');
        document.body.style.setProperty('--border-color', '#444444');

        document.getElementById('logo').getElementsByTagName('img')[0].src = "{{ '/assets/img/skill-stamp/white.png' | relative_url }}";
        document.getElementById('theme').getElementsByTagName('img')[0].src = "{{ '/assets/icon/sun/white.svg' | relative_url }}";
        document.getElementById('search').getElementsByTagName('img')[0].src = "{{ '/assets/icon/magnifier/white.svg' | relative_url }}";

        hljsStyle.href = 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/vs2015.min.css';
        hljs.highlightAll();

        renderMermaid('dark');
    }

    async function renderMermaid(theme) {
        mermaid.initialize({
            theme: theme,
            startOnLoad: false,
            securityLevel: 'loose',
        });
        await mermaid.run({ querySelector: '.language-mermaid' });
    }
</script>

</html>